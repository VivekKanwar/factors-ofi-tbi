---
title: "Manuscript title here"
format: html
author: "Your name here"
bibliography: bibliography.bib
csl: vancouver.csl
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
```


<!-- This is an R Markdown document. Markdown is a simple formatting
syntax for authoring HTML, PDF, and MS Word documents. For more
details on using R Markdown see http://rmarkdown.rstudio.com -->

<!-- This is a comment and will not be present in the compiled
document. Try "knitting" this document by clicking the knit button up
to the left, or by running `rmarkdown::render("manuscript.Rmd")` in
the console and you should only see headings -->

<!-- Structure and most comments are from the Strengthening the
reporting of observational studies in epidemiology (STROBE) statement,
see https://www.strobe-statement.org/. For more explanations see the
paper Strengthening the Reporting of Observational Studies in
Epidemiology (STROBE):explanation and elaboration.  -->

<!-- Indicate the study’s design with a commonly used term in the
title, for example: "Associations between resuscitation interventions
and opportunities for improvement in adult trauma patients: A cohort
study" -->

# Abstract

<!-- Provide in the abstract an informative and balanced summary of
what was done and what was found. Not more than 300 words. -->


## Background

## Methods

## Results

## Conclusion

# Introduction

<!-- Explain the scientific background and rationale for the
investigation being reported. End by stating the aim or specific
objectives, including any prespecified hypotheses. The introduction
should not be longer than 1-1.5 pages, typically 4-5 paragraphs, each
6-8 lines long. Support every statement with a citation -->


# Methods

## Study design

<!-- Present key elements of study design -->

## Setting

<!-- Describe the setting, locations, and relevant dates, including
periods of recruitment, exposure, follow-up, and data collection -->


## Participants

<!-- Cohort study: Give the eligibility criteria, and the sources and
methods of selection of participants. Describe methods of
follow-up. For matched studies, give matching criteria and number of
exposed and unexposed -->

<!-- Case-control study: Give the eligibility criteria, and the
sources and + methods of case ascertainment and control
selection. Give the rationale for the choice of cases and
controls. For matched studies, give matching criteria and the number
of controls per case -->

<!-- Cross-sectional study: Give the eligibility criteria, and the
sources and methods of selection of participants -->

## Variables and data sources/measurements

<!-- Clearly define all outcomes, exposures, predictors, potential
confounders, and effect modifiers. Give diagnostic criteria, if
applicable. For each variable of interest, give sources of data and
details of methods of assessment (measurement). Describe comparability
of assessment methods if there is more than one group -->


## Bias

<!-- Describe any efforts to address potential sources of bias -->

## Study size

<!-- Explain how the study size was arrived at -->

## Quantitative variables

<!-- Explain how quantitative variables were handled in the
analyses. If applicable, describe which groupings were chosen and why
-->


## Statistical methods

<!-- 

(a) Describe all statistical methods, including those used to control
for confounding

(b) Describe any methods used to examine subgroups and interactions

(c) Explain how missing data were addressed 

(d) 

Cohort study: If applicable, explain how loss to follow-up was addressed 

Case-control study:If applicable, explain how matching of cases and
controls was addressed

Cross-sectional study: If applicable, describe analytical methods
taking account of sampling strategy

(e) Describe any sensitivity analyses
-->


# Results

## Participants

<!-- (a) Report numbers of individuals at each stage of study—eg numbers
potentially eligible, examined for eligibility, confirmed eligible,
included in the study, completing follow-up, and analysed

(b) Give reasons for non-participation at each stage

(c) Consider use of a flow diagram -->


```{r flowchart, echo=FALSE}

library(DiagrammeR)
library(glue)
library(tidyverse)
library(gtsummary)
library(DiagrammeRsvg)
library(rsvg)         
source("main.R") ## This "imports" the main script file of your project and run any code in it

# Flowchart figure -----------------------------------------------------------

# ---- Counts for intermediate steps -----------------------------------------
n_excl_step1 <- n_total_merged_data - n_TBI_only_data
n_excl_step2 <- n_under18 + n_no_ofi

# ---- Labels ----------------------------------------------------------------
label_A <- glue(
  "Trauma registry 2012–2023\n",
  "n = {n_total_merged_data}"
)

label_B <- glue(
  "Identified TBI using AIS 1xxxxx.x\n",
  "n = {n_TBI_only_data}"
)

label_C <- glue(
  "Eligible adult TBI patients\n",
  "with OFI outcome\n",
  "n = {n_eligible}"
)

label_D <- glue(
  "Included (final analytic cohort)\n",
  "n = {n_final} adult TBI patients\n",
  "- OFI: {n_ofi} ({round(100 * n_ofi / n_final, 1)}%)\n",
  "- No OFI: {n_final - n_ofi}"
)

label_excl1 <- glue( 
  "Excluded (n = {n_excl_step1}):\n",
  "- No TBI according to AIS code"
  )

label_excl2 <- glue(
  "Excluded (n = {n_excl_step2}):\n",
  "- Age < 18 years: {n_under18}\n",
  "- No OFI outcome: {n_no_ofi}"
)

label_excl3 <- glue(
  "Excluded: missing data\n",
  "in covariates (n = {n_missing_cc})"
)

# ---- Producing the figure with exclusion boxes ------------------------------

g <- grViz(glue("
digraph TBI_flow {{

  graph [
    rankdir = TB,
    splines = ortho
  ]

  node [
    shape = box,
    style = rounded,
    fontname = 'Times New Roman',
    fontsize = 12,
    width = 3
  ]

  edge [
    arrowhead = normal
  ]

  // Main vertical line
  A [label = '{label_A}']
  B [label = '{label_B}']
  C [label = '{label_C}']
  D [label = '{label_D}']

  // Side exclusion boxes
  E1 [label = '{label_excl1}']
  E2 [label = '{label_excl2}']
  E3 [label = '{label_excl3}']

  // Invisible junction nodes on the vertical line
  J1 [shape=point, width=0.001, label=\"\", style=invis]
  J2 [shape=point, width=0.001, label=\"\", style=invis]
  J3 [shape=point, width=0.001, label=\"\", style=invis]

  // Main vertical line
  A -> J1 [arrowhead=none] 
  J1 -> B       
  B -> J2 [arrowhead=none] 
  J2 -> C 
  C -> J3 [arrowhead=none]
  J3 -> D
  
  // Branching arrows from the vertical line to exclusions
  J1 -> E1
  J2 -> E2
  J3 -> E3

  // Keep exclusions horizontally aligned with the junctions
  {{rank=same; J1; E1}}
  {{rank=same; J2; E2}}
  {{rank=same; J3; E3}}

}}
"))

# ---- Export (SVG + PNG) ----
svg_txt <- DiagrammeRsvg::export_svg(g)

out_svg <- file.path("assets", "flowchart.svg")
out_png <- file.path("assets", "flowchart.png")

cat(svg_txt, file = out_svg)
rsvg_png(out_svg, file = out_png, width = 1600, height = 2600)

```

![**Figure 1. Flowchart of patient selection for the analytical cohort**](assets/flowchart.png)

## Descriptive data

<!--  
(a) Give characteristics of study participants (eg demographic,
clinical, social) and information on exposures and potential
confounders

(b) Indicate number of participants with missing data for each
variable of interest

(c) Cohort study — Summarise follow-up time (eg, average and total
amount)
-->
```{r}
Descriptive.table1
```
## Outcome data

<!--  
Cohort study — Report numbers of outcome events or summary measures
over time

Case-control study — Report numbers in each exposure category, or
summary measures of exposure

Cross-sectional study — Report numbers of outcome events or summary
measures
-->

##  Main results

<!--  
(a) Give unadjusted estimates and, if applicable, confounder-adjusted
estimates and their precision (eg, 95% confidence interval). Make
clear which confounders were adjusted for and why they were included

(b) Report category boundaries when continuous variables were
categorized

(c) If relevant, consider translating estimates of relative risk into
absolute risk for a meaningful time period
-->

```{r}
SR.Table1
```

```{r}
MV.Table1
```
## Other analyses 

<!--  
Report other analyses done—eg analyses of subgroups and interactions,
and sensitivity analyses 
-->


You can include code in this document like this:

```{r main, echo=FALSE}
source("main.R") ## This "imports" the main script file of your project and run any code in it
```

You can also embed plots:

```{r plot, echo=FALSE}
plot(pressure)
```

You can also mix text and code, so called inline code, like this: `r 2+5`.

# Discussion

## Key results

<!--
Summarise key results with reference to study objectives
-->

## Limitations

<!--
Discuss limitations of the study, taking into account sources of
potential bias or imprecision.  Discuss both direction and magnitude
of any potential bias
-->

## Interpretation

<!--
Give a cautious overall interpretation of results considering
objectives, limitations, multiplicity of analyses, results from
similar studies, and other relevant evidence
-->

## Generalisability

<!-- Discuss the generalisability (external validity) of the study results -->

# Conclusion

<!-- Give a short conclusion, corresponding to the aim -->

# References

<!-- Do not edit by hand, references will be inserted and formatted automatically once you knit this document -->
